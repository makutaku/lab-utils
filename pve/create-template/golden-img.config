

# Configuration parameters
DISK_SIZE="+4G"

# Virt-customize arguments
VIRT_CUSTOMIZE_ARGS_ARRAY=(
    --timezone "America/Chicago"
    --install "curl,wget,unzip,gnupg,ca-certificates,jq,net-tools,software-properties-common,apt-transport-https,openssl,sudo,git,openssh-server,vim,make,e2fsprogs"
    --install "dnsutils,tmux,screen,ufw,iproute2,htop,bind9-dnsutils,nmap,gnutls-bin,socat,cloud-init,prometheus-node-exporter,rsyslog,nfs-common,qemu-guest-agent,bind9-utils,ncdu"
    --install "nfs-common,cifs-utils"
    --install "chrony,iptables,lsb-release,auditd,tcpdump,bc,psmisc,acl,iptables-persistent,bridge-utils,trash-cli,cloud-guest-utils"
    --run-command "sed -i 's/^#*PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config"
    --run-command "sed -i 's/^#*PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config"

    # Resize partition and filesystem inside the guest
    --run-command "growpart /dev/sda 1"
    --run-command "resize2fs /dev/sda1"

    # Clean up
    --run-command "apt-get clean"
    --run-command "rm -rf /var/lib/apt/lists/*"
    --run-command "dd if=/dev/zero of=/EMPTY bs=1M || true"
    --run-command "rm -f /EMPTY"
    --run-command "cloud-init clean"
    --truncate "/etc/machine-id"
)

